{
  "name": "Asystent Telegram - Biuro Nieruchomo≈õci (Multimodalny)",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {
          "download": true
        }
      },
      "id": "tg-trigger",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        0,
        -16
      ],
      "webhookId": "a1a0d35f-1392-4b71-bbeb-41fdc63d9fe4",
      "credentials": {
        "telegramApi": {
          "id": "8Z73UowUNXiBPVtB",
          "name": "n8ntestmultimodal"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    },
                    "id": "5761d6ac-1afe-4dbb-b706-3af603bd4113"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "7c8e98e4-5929-41b1-83a3-989e2e9d9633",
                    "leftValue": "={{ $json.message.voice }}",
                    "rightValue": "",
                    "operator": {
                      "type": "object",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "voice"
            }
          ]
        },
        "options": {}
      },
      "id": "switch-type",
      "name": "Switch - Typ Wiadomo≈õci",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        224,
        -16
      ]
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {
          "language": "pl"
        }
      },
      "id": "openai-stt",
      "name": "Whisper - Transkrypcja Audio",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2.1,
      "position": [
        672,
        80
      ],
      "credentials": {
        "openAiApi": {
          "id": "kkj14qnD4cBwY9wg",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "nv-1",
              "name": "userInput",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "nv-2",
              "name": "chatId",
              "value": "={{ $('Telegram Trigger').item.json.message.chat.id.toString() }}",
              "type": "string"
            },
            {
              "id": "nv-3",
              "name": "inputType",
              "value": "voice",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "norm-voice",
      "name": "Normalizuj G≈Ços",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        896,
        80
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "nt-1",
              "name": "userInput",
              "value": "={{ $json.message.text }}",
              "type": "string"
            },
            {
              "id": "nt-2",
              "name": "chatId",
              "value": "={{ $json.message.chat.id.toString() }}",
              "type": "string"
            },
            {
              "id": "nt-3",
              "name": "inputType",
              "value": "text",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "norm-text",
      "name": "Normalizuj Tekst",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        896,
        -112
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userInput }}",
        "options": {
          "systemMessage": "Jeste≈õ pomocnym asystentem biura nieruchomo≈õci specjalizujƒÖcego siƒô w wynajmie mieszka≈Ñ w Polsce. Twoja rola to wstƒôpna obs≈Çuga klient√≥w przez komunikator Telegram.\n\nüè† ZAKRES POMOCY:\n- Informacje o dostƒôpnych mieszkaniach do wynajƒôcia\n- Ceny wynajmu i warunki um√≥w najmu\n- Wymagane dokumenty (dow√≥d osobisty/paszport, za≈õwiadczenie o dochodach, referencje od poprzednich wynajmujƒÖcych)\n- Umawianie wizyt oglƒÖdania mieszka≈Ñ\n- Informacje o lokalizacjach, dzielnicach, komunikacji miejskiej\n- Kaucja (zazwyczaj 1-2 miesiƒÖce), czynsz administracyjny, op≈Çaty za media\n- Zasady dotyczƒÖce zwierzƒÖt domowych i palenia tytoniu\n- D≈Çugo≈õƒá um√≥w: kr√≥tkoterminowe (od 1 miesiƒÖca) i d≈Çugoterminowe (12+ miesiƒôcy)\n\nüìã ZASADY ODPOWIADANIA:\n- ZAWSZE odpowiadaj po polsku, kr√≥tko i konkretnie\n- BƒÖd≈∫ ciep≈Çy, profesjonalny i pomocny\n- Dostosuj odpowiedzi do czytania na telefonie (kr√≥tkie paragrafy, maksymalnie 3-4 zdania na punkt)\n- Na ko≈Ñcu ka≈ºdej odpowiedzi zaproponuj konkretny nastƒôpny krok (np. um√≥wienie wizyty, przes≈Çanie ofert emailem)\n- Przy niejasnych pytaniach dopytaj o szczeg√≥≈Çy: bud≈ºet, lokalizacja, liczba pokoi, data wprowadzenia\n- Kompleksowe lub prawne sprawy kieruj do agenta lub na spotkanie w biurze\n\nüìû DANE KONTAKTOWE BIURA (zastƒÖp prawdziwymi):\n- Telefon: +48 999 999 999 \n- Email: biuro@nieruchomosci.pl\n- Godziny: pon-pt 9:00-17:00, sob 10:00-14:00\n- Adres: ul. Przyk≈Çadowa 1, Warszawa\n\nPamiƒôtaj: Twoja rola to profesjonalna wstƒôpna kwalifikacja klient√≥w i zbieranie ich potrzeb.\n\nNarzƒôdzia:\n- Lista nieruchomo≈õci i ich status by Air Table - u≈ºyj tego narzƒôdzia, ≈ºeby sprawdziƒá aktualna dostƒôpno≈õƒá mieszka≈Ñ na wynajem"
        }
      },
      "id": "ai-agent",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        1552,
        -16
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "id",
          "value": "gpt-4o-mini"
        },
        "builtInTools": {},
        "options": {
          "temperature": 0.7
        }
      },
      "id": "llm-openai",
      "name": "GPT-4o-mini",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1360,
        208
      ],
      "credentials": {
        "openAiApi": {
          "id": "kkj14qnD4cBwY9wg",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.chatId }}",
        "contextWindowLength": 10
      },
      "id": "memory-node",
      "name": "Pamiƒôƒá Rozmowy",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1488,
        208
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "tg-send",
      "name": "Wy≈õlij Odpowied≈∫",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1904,
        -16
      ],
      "webhookId": "738e3154-cbbf-44a8-bc98-8622cfbad022",
      "credentials": {
        "telegramApi": {
          "id": "8Z73UowUNXiBPVtB",
          "name": "n8ntestmultimodal"
        }
      }
    },
    {
      "parameters": {
        "content": "## üè† Multimodalny Asystent Telegram\n### Biuro Nieruchomo≈õci - Wynajem Mieszka≈Ñ\n\n**2 modalno≈õci wej≈õciowe:**\nüé§ G≈Ços ‚Üí Whisper STT ‚Üí tekst\nüí¨ Tekst ‚Üí bez zmian\n\n**Wymagane kredencja≈Çy:**\n1. Telegram Bot API (BotFather)\n2. OpenAI API Key\n\n**Setup po deploymencie:**\n- Zaktualizuj dane kontaktowe biura w System Prompt wƒôz≈Ça AI Agent",
        "height": 230,
        "width": 360,
        "color": 4
      },
      "id": "note-main",
      "name": "üìã INFO - Asystent Biura",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -48,
        -208
      ]
    },
    {
      "parameters": {
        "content": "## ü§ñ AI Agent z PamiƒôciƒÖ\n\n**Model:** GPT-4o-mini\n**Pamiƒôƒá:** 10 ostatnich wiadomo≈õci\n**Sesja:** unikalna per u≈ºytkownik\n(klucz = chat.id)\n\n**Output:** zawsze tekst\n‚Üí Telegram sendMessage",
        "height": 230,
        "width": 300,
        "color": 6
      },
      "id": "note-ai",
      "name": "ü§ñ AI + PAMIƒòƒÜ",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        656,
        -448
      ]
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.message.voice.file_id }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        448,
        80
      ],
      "id": "9ea9deef-bc7d-49a6-964e-80c42ec49e19",
      "name": "Get a file",
      "webhookId": "3b063ece-840e-4c1c-9213-0f7c05c0b0a1",
      "credentials": {
        "telegramApi": {
          "id": "8Z73UowUNXiBPVtB",
          "name": "n8ntestmultimodal"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1120,
        -16
      ],
      "id": "1784e849-6f7a-4a4e-bf82-31900b2dec93",
      "name": "Merge"
    },
    {
      "parameters": {
        "operation": "sendChatAction",
        "chatId": "={{ $json.chatId }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1264,
        -144
      ],
      "id": "b706f897-1e8c-479b-a401-76ff5f8213e5",
      "name": "Send a chat action",
      "webhookId": "72604dc1-be03-483c-9dfa-202f1fd7ffa3",
      "credentials": {
        "telegramApi": {
          "id": "8Z73UowUNXiBPVtB",
          "name": "n8ntestmultimodal"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Search records in Airtable.\n\nHere is the schema for Properties:\n\nProperty Name\n\nType: Text\nPrimary identifier for the property\nAddress\n\nType: Text\nIdentifier for the street\nStreet\n\nType: Text\nStreet address of the property\nType\n\nType: Single select\nOptions: Apartment, House, Condo, Townhouse, Studio, Other\nBedrooms\n\nType: Number (integer)\nCount of bedrooms\nBathrooms\n\nType: Number (integer)\nCount of bathrooms\nSquare Footage\n\nType: Number (integer)\nSize of the property in square feet\nRent Price\n\nType: Currency (USD)\nMonthly rent amount\nAvailability Status\n\nType: Single select\nOptions: Available, Rented, Upcoming\nDescription\n\nType: Long text\nDetailed description of the property\nListed Date\n\nType: Date\nDate when the property was listed\nLink to Products\n\nType: Linked record\nConnection to Products\nLandlords\n\nType: Linked record\nConnection to Landlords\nTenants\n\nType: Linked record\nConnection to Tenants\n\n",
        "authentication": "airtableOAuth2Api",
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appwAWv3Q9PMNlH0a",
          "mode": "list",
          "cachedResultName": "TestApp",
          "cachedResultUrl": "https://airtable.com/appwAWv3Q9PMNlH0a"
        },
        "table": {
          "__rl": true,
          "value": "tblisFD03XtJfhn4U",
          "mode": "list",
          "cachedResultName": "Properties",
          "cachedResultUrl": "https://airtable.com/appwAWv3Q9PMNlH0a/tblisFD03XtJfhn4U"
        },
        "filterByFormula": "={{ $fromAI('Filter_By_Formula', ``, 'string') }}",
        "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.airtableTool",
      "typeVersion": 2.1,
      "position": [
        1712,
        192
      ],
      "id": "7ccc3987-178c-4308-b9a2-f7a27a6e8727",
      "name": "Lista nieruchomosci i ich status by Air Table",
      "credentials": {
        "airtableOAuth2Api": {
          "id": "q0rdYtVN2kJpwahI",
          "name": "Airtable Personal Access Token account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Switch - Typ Wiadomo≈õci",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch - Typ Wiadomo≈õci": {
      "main": [
        [
          {
            "node": "Normalizuj Tekst",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get a file",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Whisper - Transkrypcja Audio": {
      "main": [
        [
          {
            "node": "Normalizuj G≈Ços",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalizuj G≈Ços": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Normalizuj Tekst": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Wy≈õlij Odpowied≈∫",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GPT-4o-mini": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Pamiƒôƒá Rozmowy": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Get a file": {
      "main": [
        [
          {
            "node": "Whisper - Transkrypcja Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Send a chat action",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a chat action": {
      "main": [
        []
      ]
    },
    "Lista nieruchomosci i ich status by Air Table": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "timeSavedMode": "fixed",
    "binaryMode": "separate"
  },
  "versionId": "7fd10d4b-daf7-405a-b3d4-e3d74692977c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "09373dc29972a821f2f36cf9017baede51510d6d820d175935c22f645f9e4095"
  },
  "id": "mkxYCKiBXtS8vglb",
  "tags": []
}